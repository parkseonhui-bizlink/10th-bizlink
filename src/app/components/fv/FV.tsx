'use client'
import '@/styles/fv/fv.css'
import { useEffect, useRef, useState } from 'react'
import { gsap } from 'gsap'

const FV = () => {
  const containerRef = useRef<HTMLDivElement | null>(null)
  const svgRef = useRef<SVGSVGElement | null>(null)
  const [itemCount, setItemCount] = useState<number | null>(null)

  useEffect(() => {
    const handleResize = () => {
      setItemCount(window.innerWidth <= 768 ? 12 : 16)
    }
    handleResize()
    window.addEventListener('resize', handleResize)
    return () => window.removeEventListener('resize', handleResize)
  }, [])

  useEffect(() => {
    const container = containerRef.current
    if (!container) return
    const items = Array.from(container.querySelectorAll('.gridItem'))
    const shuffled = items.sort(() => Math.random() - 0.5)

    shuffled.forEach((item, i) => {
      gsap.to(item, {
        opacity: 1,
        delay: i * 0.1,
        duration: 0.4,
        ease: 'power2.out',
      })
    })
  }, [itemCount])

  useEffect(() => {
    const svg = svgRef.current
    if (!svg) return
    const paths = Array.from(svg.querySelectorAll('path'))
    const correctOrder = [
      paths[11],
      paths[12],
      paths[13],
      paths[14],
      paths[15],
      paths[16],
      paths[17],
      paths[18],
      paths[19],
      paths[paths.length - 2],
      paths[paths.length - 1],
      paths[20],
      paths[21],
      paths[0],
      paths[1],
      paths[2],
      paths[3],
      paths[4],
      paths[5],
      paths[6],
      paths[7],
      paths[8],
      paths[9],
      paths[10],
    ]

    correctOrder.forEach((path, i) => {
      const length = path.getTotalLength()

      path.style.strokeDasharray = `${length}`
      path.style.strokeDashoffset = `${length}`
      path.style.animation = `draw 1s ease forwards`
      path.style.animationDelay = `${i * 100}ms`

      setTimeout(
        () => {
          path.style.animation = 'fillIn 1s ease-out forwards'
        },
        1000 + i * 100
      )
    })
  }, [])

  return (
    <section className="fv">
      <div ref={containerRef} className="gridContainer">
        <figure className="svgBox">
          <svg
            ref={svgRef}
            width="439"
            height="399"
            viewBox="0 0 439 399"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g clipPath="url(#clip0_585_32)">
              <path
                d="M371.2 367.7L432 358.6V374.8L421.1 375.6V381.3L432 382.3V398.7L371.2 390.6V367.7ZM410.3 376.1C403.4 376.9 394.9 377.7 384.7 378.5C396.4 380.1 404.9 381.1 410.3 381.5V376.1Z"
                fill="none"
              />
              <path
                d="M382.1 339.4L386.7 339.7C384.9 338.6 383.5 337.2 382.6 335.7C381.7 334.2 381.2 332.3 381.2 330.2C381.2 328.1 381.8 325.5 383 323.8C384.2 322.1 385.8 321.1 387.6 320.6C389.5 320.1 392.6 319.9 396.9 319.9H431.9V335.1H397.4C394 335.1 391.9 335.2 391.1 335.4C390.3 335.6 390 336.3 390 337.3C390 338.3 390.4 339.1 391.3 339.3C392.2 339.6 394.5 339.7 398.2 339.7H431.9V354.9H382V339.4H382.1Z"
                fill="none"
              />
              <path
                d="M382.1 297.6L386.7 297.9C384.9 296.8 383.5 295.4 382.6 293.9C381.7 292.4 381.2 290.5 381.2 288.4C381.2 286.3 381.8 283.7 383 282C384.2 280.3 385.8 279.3 387.6 278.8C389.5 278.3 392.6 278.1 396.9 278.1H431.9V293.3H397.4C394 293.3 391.9 293.4 391.1 293.6C390.3 293.8 390 294.5 390 295.5C390 296.5 390.4 297.3 391.3 297.5C392.2 297.8 394.5 297.9 398.2 297.9H431.9V313.1H382V297.6H382.1Z"
                fill="none"
              />
              <path
                d="M371.2 255.6H379.1V271.2H371.2V255.6ZM382.1 255.6H432V271.2H382.1V255.6Z"
                fill="none"
              />
              <path
                d="M382.1 217.2L432 224.3V244.2L382.1 251.8V238.2L418.5 233.9C415.8 233.6 409.3 233 398.9 232.2C393.1 231.8 387.5 231.3 382.1 230.7V217.1V217.2Z"
                fill="none"
              />
              <path
                d="M408 179.1V198.8H418.8C421.1 198.8 422.5 198.6 423.2 198.3C423.9 198 424.2 197.3 424.2 196.4C424.2 195.5 423.8 194.5 422.9 194.1C422 193.7 420.4 193.5 417.9 193.5H411.3V179.1H415C418.1 179.1 420.4 179.3 422.1 179.7C423.8 180.1 425.5 181 427.4 182.4C429.3 183.8 430.7 185.6 431.6 187.8C432.5 190 433 192.7 433 196.1C433 199.5 432.5 202.1 431.6 204.6C430.7 207.1 429.4 209 427.8 210.3C426.2 211.7 424.4 212.6 422.5 213.1C420.6 213.6 417.7 213.9 414 213.9H399.5C395.1 213.9 391.7 213.3 389.2 212.1C386.7 210.9 384.8 209 383.4 206.3C382.1 203.6 381.4 200.5 381.4 197.1C381.4 193.7 382.2 189.3 383.8 186.6C385.4 183.9 387.6 181.9 390.2 180.8C392.9 179.7 396.6 179.1 401.5 179.1H408.1H408ZM399.8 194.3H396.2C393.6 194.3 392 194.4 391.2 194.7C390.4 195 390.1 195.5 390.1 196.4C390.1 197.3 390.4 198.1 391.1 198.4C391.8 198.7 393.5 198.8 396.3 198.8H399.9V194.4L399.8 194.3Z"
                fill="none"
              />
              <path
                d="M382.1 157.4L388.7 158C384 155.8 381.5 152.6 381.2 148.4H398.8C398.8 151.2 399.2 153.2 399.9 154.5C400.7 155.8 401.7 156.6 403 156.9C404.3 157.2 407.4 157.4 412.3 157.4H432V172.6H382.1V157.4Z"
                fill="none"
              />
              <path
                d="M398.1 112.4V125.9H395.4C393.1 125.9 391.6 126 391 126.3C390.4 126.6 390.1 127.2 390.1 128.3C390.1 129.4 390.4 129.8 390.9 130.2C391.5 130.6 392.3 130.8 393.4 130.8C394.5 130.8 396 130.7 396.8 130.5C397.5 130.3 398.3 129.6 399.1 128.6C400 127.5 401.2 125.3 402.8 122C405 117.6 407 114.7 408.9 113.3C410.8 111.9 413.6 111.2 417.2 111.2C420.8 111.2 424.3 111.7 426.4 112.8C428.5 113.9 430.1 115.6 431.2 118.1C432.3 120.6 432.9 123.5 432.9 127C432.9 130.5 432.3 134.2 431.1 136.9C429.9 139.6 428.3 141.5 426.2 142.6C424.1 143.6 421 144.1 416.9 144.1H414.5V130.6H417.7C420.4 130.6 422.1 130.4 422.9 130.1C423.7 129.8 424.1 129.1 424.1 128.1C424.1 127.1 423.8 126.3 423.3 125.8C422.8 125.4 421.6 125.2 419.9 125.2C418.2 125.2 416 125.5 415.4 126C414.8 126.6 413 129.5 410.1 134.8C407.6 139.3 405.3 142 403.3 143C401.3 144 398.8 144.5 396 144.5C392 144.5 389.1 144 387.2 142.9C385.3 141.8 383.8 140.1 382.8 137.5C381.8 134.9 381.3 132.1 381.3 128.7C381.3 125.3 381.7 122.6 382.6 120.3C383.4 118 384.5 116.2 385.9 115C387.3 113.8 388.6 113 389.7 112.7C390.9 112.4 392.7 112.3 395.2 112.3H398.1V112.4Z"
                fill="none"
              />
              <path
                d="M401.5 92.1V106.3H398.2C394.3 106.3 391.4 105.9 389.3 105C387.2 104.1 385.4 102.3 383.8 99.6C382.2 96.9 381.4 93.4 381.4 89.1C381.4 84.8 382.3 80.1 384.1 77.5C385.9 74.9 388.1 73.3 390.8 72.8C393.4 72.3 398.9 72 407.1 72H432.1V86.8H427.7C429.5 87.7 430.8 88.9 431.7 90.4C432.6 91.9 433 93.6 433 95.6C433 97.6 432.3 100.7 430.8 102.9C429.3 105.1 426 106.2 421 106.2H416.9C413.2 106.2 410.6 105.6 409.3 104.4C407.9 103.2 406.4 100.3 404.6 95.6C402.6 90.6 401.3 87.9 400.7 87.6C400 87.2 398.6 87.1 396.6 87.1C394.6 87.1 392.3 87.3 391.5 87.7C390.7 88.1 390.3 88.7 390.3 89.6C390.3 90.5 390.6 91.3 391.3 91.5C392 91.8 393.7 91.9 396.5 91.9H401.7L401.5 92.1ZM408.3 87.3C410.1 89.7 411.6 91.1 412.8 91.5C414 91.9 415.7 92.1 418 92.1C420.3 92.1 422.2 91.9 423 91.6C423.8 91.3 424.1 90.6 424.1 89.6C424.1 88.6 423.8 88 423.2 87.7C422.6 87.4 421.1 87.3 418.6 87.3H408.3Z"
                fill="none"
              />
              <path
                d="M382.1 50.0996L388.7 50.6996C384 48.4996 381.5 45.2996 381.2 41.0996H398.8C398.8 43.8996 399.2 45.8996 399.9 47.1996C400.7 48.4996 401.7 49.2996 403 49.5996C404.3 49.8996 407.4 50.0996 412.3 50.0996H432V65.2996H382.1V50.0996Z"
                fill="none"
              />
              <path
                d="M382.1 3L418.2 7.3C423.9 8 427.8 8.6 429.9 9C432 9.5 433.7 10.2 435 11.3C436.4 12.4 437.3 13.9 438 15.8C438.6 17.7 439 20.8 439 25V34.2H431C431 31.8 430.9 30.3 430.6 29.6C430.4 28.9 429.8 28.6 429 28.6C428.2 28.6 426.9 28.9 423.8 29.5L382.1 37.8V24L415.8 19L382.1 16.6V3Z"
                fill="none"
              />
              <path
                d="M34.3001 389V397.4H7.1001V390.3C15.2001 377.1 19.9001 369 21.5001 365.9C23.0001 362.8 23.8001 360.3 23.8001 358.6C23.8001 356.9 23.6001 356.3 23.1001 355.6C22.6001 354.9 21.9001 354.6 21.0001 354.6C20.1001 354.6 19.4001 355 18.9001 355.7C18.4001 356.4 18.2001 357.9 18.2001 360.1V364.8H7.1001V363C7.1001 360.2 7.2001 358 7.5001 356.4C7.8001 354.8 8.5001 353.2 9.6001 351.7C10.7001 350.2 12.2001 349 14.0001 348.2C15.8001 347.4 17.9001 347 20.5001 347C25.4001 347 29.1001 348.2 31.6001 350.7C34.1001 353.2 35.4001 356.2 35.4001 359.9C35.4001 363.6 34.7001 365.7 33.3001 368.9C31.9001 372.1 27.7001 378.8 20.8001 389H34.4001H34.3001Z"
                fill="none"
              />
              <path
                d="M69.5001 364.7V381.2C69.5001 385 69.3001 387.7 68.9001 389.4C68.5001 391.1 67.6001 392.7 66.4001 394.2C65.1001 395.7 63.6001 396.8 61.8001 397.4C60.0001 398.1 58.0001 398.4 55.7001 398.4C53.4001 398.4 50.3001 398.1 48.3001 397.4C46.3001 396.7 44.8001 395.7 43.6001 394.2C42.4001 392.8 41.6001 391.2 41.1001 389.6C40.6001 388 40.4001 385.5 40.4001 382V364.7C40.4001 360.2 40.8001 356.8 41.6001 354.5C42.4001 352.2 43.9001 350.4 46.3001 349.1C48.6001 347.7 51.5001 347.1 54.8001 347.1C58.1001 347.1 59.9001 347.6 62.1001 348.5C64.3001 349.4 65.8001 350.6 66.9001 352C68.0001 353.4 68.7001 354.9 69.1001 356.6C69.5001 358.3 69.7001 361 69.7001 364.8L69.5001 364.7ZM57.2001 360.6C57.2001 358 57.1001 356.3 56.8001 355.7C56.5001 355 55.9001 354.7 55.0001 354.7C54.1001 354.7 53.5001 355.1 53.2001 355.8C52.9001 356.5 52.8001 358.1 52.8001 360.7V384.9C52.8001 387.8 52.9001 389.5 53.2001 390.1C53.5001 390.7 54.1001 391 55.0001 391C55.9001 391 56.5001 390.7 56.8001 390C57.1001 389.3 57.2001 387.7 57.2001 385.3V360.8V360.6Z"
                fill="none"
              />
              <path
                d="M94.3001 348V397.5H81.9001V371C81.9001 367.2 81.9001 364.9 81.6001 364.1C81.4001 363.3 80.9001 362.7 80.1001 362.3C79.3001 361.9 77.4001 361.7 74.6001 361.7H73.4001V355.9C79.4001 354.6 83.9001 352 87.0001 348H94.3001Z"
                fill="none"
              />
              <path
                d="M127.3 348V355.9H112V364.3C113.9 362 116.4 360.9 119.4 360.9C122.4 360.9 125.4 361.9 127.1 363.8C128.8 365.7 129.7 369.4 129.7 374.8V381.9C129.7 385.4 129.5 388 129.2 389.6C128.9 391.2 128.1 392.8 127 394.2C125.9 395.6 124.4 396.7 122.4 397.4C120.4 398.1 118 398.5 115.2 398.5C112.4 398.5 109.2 397.9 106.8 396.8C104.4 395.7 102.7 394 101.6 391.8C100.6 389.6 100.1 386.2 100.1 381.6V378.9H112.5V382C112.5 385.2 112.6 387.5 112.8 388.8C113 390.1 113.8 390.8 115.1 390.8C116.4 390.8 116.2 390.6 116.6 390.2C117 389.8 117.2 389.4 117.2 388.9C117.2 388.5 117.2 386.5 117.3 383.1V373.3C117.3 371.4 117.1 370.2 116.7 369.5C116.3 368.8 115.7 368.5 114.8 368.5C113.9 368.5 113.7 368.7 113.4 369C113 369.3 112.8 369.7 112.7 370.1C112.6 370.5 112.5 371.4 112.5 372.9H100.3L100.8 348H127.3Z"
                fill="none"
              />
              <path d="M174.9 372.9V381.4H158.7V372.9H174.9Z" fill="none" />
              <path
                d="M230.7 389V397.4H203.5V390.3C211.6 377.1 216.3 369 217.9 365.9C219.4 362.8 220.2 360.3 220.2 358.6C220.2 356.9 220 356.3 219.5 355.6C219 354.9 218.3 354.6 217.4 354.6C216.5 354.6 215.8 355 215.3 355.7C214.8 356.4 214.6 357.9 214.6 360.1V364.8H203.5V363C203.5 360.2 203.6 358 203.9 356.4C204.2 354.8 204.9 353.2 206 351.7C207.1 350.2 208.6 349 210.4 348.2C212.2 347.4 214.3 347 216.9 347C221.8 347 225.5 348.2 228 350.7C230.5 353.1 231.8 356.2 231.8 359.9C231.8 363.6 231.1 365.7 229.7 368.9C228.3 372.1 224.1 378.8 217.2 389H230.8H230.7Z"
                fill="none"
              />
              <path
                d="M265.9 364.7V381.2C265.9 385 265.7 387.7 265.3 389.4C264.9 391.1 264 392.7 262.8 394.2C261.5 395.7 260 396.8 258.2 397.4C256.4 398.1 254.4 398.4 252.1 398.4C249.8 398.4 246.7 398.1 244.7 397.4C242.7 396.7 241.2 395.7 240 394.2C238.8 392.7 238 391.2 237.5 389.6C237 388 236.8 385.5 236.8 382V364.7C236.8 360.2 237.2 356.8 238 354.5C238.8 352.2 240.3 350.4 242.7 349.1C245.1 347.8 247.9 347.1 251.2 347.1C254.5 347.1 256.3 347.6 258.5 348.5C260.6 349.4 262.2 350.6 263.3 352C264.4 353.4 265.1 354.9 265.5 356.6C265.9 358.3 266.1 361 266.1 364.8L265.9 364.7ZM253.5 360.6C253.5 358 253.4 356.3 253.1 355.7C252.8 355 252.2 354.7 251.3 354.7C250.4 354.7 249.8 355.1 249.5 355.8C249.2 356.5 249.1 358.1 249.1 360.7V384.9C249.1 387.8 249.2 389.5 249.5 390.1C249.8 390.7 250.4 391 251.3 391C252.2 391 252.8 390.7 253.1 390C253.4 389.3 253.5 387.7 253.5 385.3V360.8V360.6Z"
                fill="none"
              />
              <path
                d="M298.2 389V397.4H271V390.3C279.1 377.1 283.8 369 285.4 365.9C286.9 362.8 287.7 360.3 287.7 358.6C287.7 356.9 287.5 356.3 287 355.6C286.5 354.9 285.8 354.6 284.9 354.6C284 354.6 283.3 355 282.8 355.7C282.3 356.4 282.1 357.9 282.1 360.1V364.8H271V363C271 360.2 271.1 358 271.4 356.4C271.7 354.8 272.4 353.2 273.5 351.7C274.6 350.2 276.1 349 277.9 348.2C279.7 347.4 281.8 347 284.4 347C289.3 347 293 348.2 295.5 350.7C298 353.1 299.3 356.2 299.3 359.9C299.3 363.6 298.6 365.7 297.2 368.9C295.8 372.1 291.6 378.8 284.7 389H298.3H298.2Z"
                fill="none"
              />
              <path
                d="M331.3 348V355.9H316V364.3C317.9 362 320.4 360.9 323.4 360.9C326.4 360.9 329.4 361.9 331.1 363.8C332.8 365.7 333.7 369.4 333.7 374.8V381.9C333.7 385.4 333.5 388 333.2 389.6C332.9 391.2 332.1 392.8 331 394.2C329.9 395.6 328.4 396.7 326.4 397.4C324.4 398.1 322 398.5 319.2 398.5C316.4 398.5 313.2 397.9 310.8 396.8C308.4 395.7 306.6 394 305.6 391.8C304.6 389.6 304.1 386.2 304.1 381.6V378.9H316.5V382C316.5 385.2 316.6 387.5 316.8 388.8C317 390.1 317.8 390.8 319.1 390.8C320.4 390.8 320.2 390.6 320.6 390.2C321 389.8 321.2 389.4 321.2 388.9C321.2 388.5 321.2 386.5 321.3 383.1V373.3C321.3 371.4 321.1 370.2 320.7 369.5C320.3 368.8 319.7 368.5 318.8 368.5C317.9 368.5 317.7 368.7 317.4 369C317 369.3 316.8 369.7 316.6 370.1C316.4 370.5 316.4 371.4 316.4 372.9H304.2L304.7 348H331.2H331.3Z"
                fill="none"
              />
              <path
                d="M283.3 193.499V202.199H287.8V210.899H283.3V240.499C283.3 244.099 283.5 246.199 283.9 246.599C284.3 246.999 285.8 247.199 288.6 247.199V256.099H281.8C278 256.099 275.2 255.899 273.6 255.599C272 255.299 270.5 254.499 269.3 253.399C268.1 252.199 267.3 250.899 267 249.399C266.7 247.899 266.5 244.399 266.5 238.899V210.799H262.9V202.099H266.5V193.399H283.4L283.3 193.499Z"
                fill="white"
              />
              <path
                d="M310 188.8V204C311.4 202.7 313 201.7 314.7 201C316.4 200.3 318.2 200 320.1 200C323 200 325.5 200.8 327.6 202.2C329.7 203.7 330.9 205.4 331.4 207.4C331.9 209.4 332.1 212.9 332.1 218.1V256.2H315.3V217.3C315.3 214.1 315.1 212 314.8 211.1C314.5 210.2 313.8 209.7 312.7 209.7C311.6 209.7 311 210.2 310.6 211.1C310.2 212 310.1 213.9 310.1 216.7V256.2H293.3V188.8H310.1H310Z"
                fill="white"
              />
              <path
                d="M133.4 3.59961V318.7H54.6999V149.7C54.6999 125.3 54.0999 110.6 52.8999 105.7C51.6999 100.8 48.4999 96.9996 43.2999 94.4996C38.0999 91.9996 26.2999 90.6996 8.1999 90.6996H0.399902V53.9996C38.3999 45.8996 67.2999 29.0996 86.9999 3.59961H133.3H133.4Z"
                fill="none"
              />
              <path
                d="M257 264.5C256.6 268 256 270.7 255.3 272.4C253.5 276.8 249.7 279 243.8 279C237.9 279 234.2 277.1 232.4 273.4C230.6 269.6 229.8 258.6 229.8 240.3V86.5002C229.8 70.3002 230.7 59.9002 232.6 55.5002C234.5 51.0002 238.3 48.8002 244.2 48.8002C250.1 48.8002 254 50.9002 255.6 55.1002C257.2 59.3002 258 69.8002 258 86.5002V183.7H336.6V113C336.6 89.1002 335.4 71.7002 333 60.8002C330.6 49.9002 326 40.1002 319.3 31.4002C312.6 22.7002 302.4 15.3002 288.7 9.3002C275.1 3.3002 259.6 0.200195 242.4 0.200195C225.2 0.200195 203.2 4.5002 188.4 13.2002C173.5 21.9002 163.6 33.4002 158.6 47.8002C153.6 62.2002 151.1 83.9002 151.1 112.8V222.8C151.1 245 152.7 261.2 155.8 271.4C158.9 281.6 164.2 291.3 171.6 300.5C179 309.7 188.9 316.5 201.4 320.8C213.9 325.1 229.5 327.3 248.3 327.3C267.1 327.3 275.5 325.2 287 321.1C298.5 316.9 308.4 310.1 316.6 300.7C324.8 291.2 330.2 281 332.8 270.1C333.2 268.3 333.6 266.4 333.9 264.3H257V264.5Z"
                fill="none"
              />
            </g>
            <defs>
              <clipPath id="clip0_585_32">
                <rect width="439" height="399" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </figure>
        {itemCount !== null &&
          Array.from({ length: itemCount }).map((_, index) => (
            <div key={index} className="gridItem">
              <img
                src={`/images/section/FVSection/fv${index + 1}.jpg`}
                alt="image"
              />
            </div>
          ))}
        <div className="srcollBox">
          <span>scroll</span>
          <div className="arrows">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </section>
  )
}

export default FV
